<div class="header-top-row">
	<div class="navbar-title"><a href="/" style="text-decoration: none;">salvaged.work</a></div>
	<div class="navbar-links-container">
		{% for item in site.data.header %}
		<a href="{{ item.link }}" {% if page.url == item.link %}class="navbar-link current"{% endif %} class="navbar-link">{{ item.name }}</a>
		{% endfor %}
		<div class="header-search-container header-search-desktop">
			<input type="text" id="header-search-input-desktop" class="header-search-input" placeholder="Search..." autocomplete="off" />
			<div id="header-search-results-desktop" class="header-search-results"></div>
		</div>
	</div>
	<button class="burger-menu" id="burger-menu" aria-label="Toggle menu">
		<span class="burger-line"></span>
		<span class="burger-line"></span>
		<span class="burger-line"></span>
	</button>
</div>

<div class="mobile-nav" id="mobile-nav">
	{% for item in site.data.header %}
	<a href="{{ item.link }}" class="mobile-nav-link">{{ item.name }}</a>
	{% endfor %}
	<div class="mobile-nav-divider"></div>
	{% for item in site.data.footer %}
	<a href="{{ item.link }}" class="mobile-nav-link">{{ item.name }}</a>
	{% endfor %}
	<div class="mobile-nav-social">
		<a href="https://www.instagram.com/salvagedwork/" class="social-media-icon" target="_blank"><span class="icon-instagram"></span></a>
		<a href="https://twitter.com/salvagedwork" class="social-media-icon" target="_blank"><span class="icon-twitter"></span></a>
	</div>
</div>

<div class="header-search-container header-search-mobile">
	<input type="text" id="header-search-input-mobile" class="header-search-input" placeholder="Search..." autocomplete="off" />
	<div id="header-search-results-mobile" class="header-search-results"></div>
</div>

<script src="/js/simple-jekyll-search.min.js" type="text/javascript"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
	// Burger menu toggle
	const burgerMenu = document.getElementById('burger-menu');
	const mobileNav = document.getElementById('mobile-nav');
	
	burgerMenu.addEventListener('click', function() {
		this.classList.toggle('active');
		mobileNav.classList.toggle('visible');
	});
	
	// Search functionality - set up for both desktop and mobile inputs
	function setupSearch(inputId, resultsId) {
		const searchInput = document.getElementById(inputId);
		const searchResults = document.getElementById(resultsId);
		
		if (!searchInput || !searchResults) return;
		
		let currentQuery = '';
		
		function escapeRegex(string) {
			return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
		}
		
		function highlightMatch(text, query) {
			if (!query || !text) return text;
			const regex = new RegExp('(' + escapeRegex(query) + ')', 'gi');
			return text.replace(regex, '<mark class="search-highlight">$1</mark>');
		}
		
		SimpleJekyllSearch({
			searchInput: searchInput,
			resultsContainer: searchResults,
			json: '/search.json',
			searchResultTemplate: '<a href="{url}" class="header-search-result"><span class="header-search-result-title">{title}</span><span class="header-search-result-desc">{description}</span></a>',
			noResultsText: '<div class="header-search-no-results">No results found</div>',
			limit: 8,
			sortMiddleware: function(a, b) {
				const query = currentQuery.toLowerCase();
				const aTitle = (a.title || '').toLowerCase();
				const bTitle = (b.title || '').toLowerCase();
				
				const aStartsWith = aTitle.startsWith(query);
				const bStartsWith = bTitle.startsWith(query);
				if (aStartsWith && !bStartsWith) return -1;
				if (!aStartsWith && bStartsWith) return 1;
				
				const aTitleContains = aTitle.includes(query);
				const bTitleContains = bTitle.includes(query);
				if (aTitleContains && !bTitleContains) return -1;
				if (!aTitleContains && bTitleContains) return 1;
				
				return aTitle.localeCompare(bTitle);
			},
			templateMiddleware: function(prop, value, template) {
				if (prop === 'title' || prop === 'description') {
					return highlightMatch(value, currentQuery);
				}
				return value;
			}
		});
		
		searchInput.addEventListener('input', function() {
			currentQuery = this.value;
			if (this.value.length > 0) {
				searchResults.classList.add('visible');
			} else {
				searchResults.classList.remove('visible');
			}
		});
		
		searchInput.addEventListener('focus', function() {
			if (this.value.length > 0) {
				searchResults.classList.add('visible');
			}
		});
		
		document.addEventListener('click', function(e) {
			if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
				searchResults.classList.remove('visible');
			}
		});
		
		searchInput.addEventListener('keydown', function(e) {
			if (e.key === 'Escape') {
				searchResults.classList.remove('visible');
				this.blur();
			}
		});
		
		searchResults.addEventListener('click', function(e) {
			if (e.target.closest('.header-search-result')) {
				searchResults.classList.remove('visible');
			}
		});
	}
	
	setupSearch('header-search-input-desktop', 'header-search-results-desktop');
	setupSearch('header-search-input-mobile', 'header-search-results-mobile');
});
</script>
